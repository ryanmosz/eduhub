# Developer Onboarding Cheat-Sheet

Welcome to the EduHub modernization sprint!
This page distills the **must-know** facts for working productively in this repo.

## 1. Repository Layout (High-Level)

| Path | Purpose |
|------|---------|
| `src/` | Application code (namespaced packages live here). |
| `tests/` | Pytest suites (mirrors structure under `src/`). |
| `docs/` | Project documentation (plans, design notes, this guide). |
| `tasks/` | PRDs & task lists generated by the AI workflow. |
| `upstream/` | Checked-in Plone buildout & CMFPlone sources. |
| `Dockerfile`, `docker-compose.yml` | Container build & multi-service dev stack. |
| `.github/workflows/` | CI pipelines (lint, test, build, deploy). |

## 2. Python Versions & Virtual Envs

* Supported: **3.9** (legacy) & **3.11** (target).
* Create a local venv:

```bash
python3.11 -m venv .venv
source .venv/bin/activate
pip install -r requirements-dev.txt
```

* Use **`tox`** to test against both versions:

```bash
tox                # runs all envs
tox -e py311       # single env
```

## 3. Auth0 Setup (Required)

**CRITICAL**: New developers must configure Auth0 before the application will work.

### Quick Setup:
1. **Get credentials** from project maintainer or set up your own Auth0 tenant
2. **Create `.env` file** in project root:
```bash
AUTH0_DOMAIN=dev-1fx6yhxxi543ipno.us.auth0.com
AUTH0_CLIENT_ID=s05QngyZXEI3XNdirmJu0CscW1hNgaRD
AUTH0_ALGORITHMS=["RS256"]
```
3. **Test authentication** at `http://localhost:8000/test/auth-console`

### Detailed Setup:
See `docs/getting-started/authentication-setup.md` for complete Auth0 configuration instructions.

## 4. Docker & Compose

Local full-stack:

```bash
docker compose up -d   # Plone, Postgres, Redis, FastAPI, etc.
```

*The first build can take a while‚Äîgrab a coffee ‚òïÔ∏è.*

Common commands:

| Action | Command |
|--------|---------|
| rebuild images | `docker compose build` |
| view logs | `docker compose logs -f [service]` |
| stop stack | `docker compose down` |

## 5. Running Tests

```bash
pytest -q                # fast feedback
pytest -q tests/hello.py # single file

# Integration testing (Auth0 + Plone)
python scripts/quick_integration_test.py
```

* Async tests use **pytest-asyncio**; mark with `@pytest.mark.asyncio`.

Coverage & benchmarks run automatically in CI.

## 6. Code Quality Gates

Tool | Invocation | CI Gate
-----|------------|--------
Black | `black .` | must pass
Isort | `isort .` | must pass
Mypy | `mypy src/` | warnings fail CI
Flake8 (via Ruff soon) | `flake8` | advisory
Pre-commit | `pre-commit run -a` | auto-fix hooks

Tip: install the git hook once:

```bash
pre-commit install
```

## 7. Commit & Branch Strategy

* **Conventional Commits** (`feat:`, `fix:`, `docs:`, `chore:` ‚Ä¶).
* Feature branches from `main`, PR via GitHub.

Example:

```
feat(api): add /hello endpoint

Adds async FastAPI route /hello returning JSON {"msg":"Hello World"}.
Updates tests and OpenAPI docs.
```

## 8. Current Project Status

**Phase 3 Complete**: OAuth2/SSO Gateway with Auth0 integration
- ‚úÖ Auth0 OAuth2 authorization code flow
- ‚úÖ JWT token validation and session management
- ‚úÖ Plone user mapping and role integration
- ‚úÖ Rate limiting and security features
- ‚úÖ Interactive test console for OAuth flows

**Next Phase**: CSV Schedule Importer and additional features

## 9. Environment Variables

1. Duplicate `.env.example` ‚Üí `.env`.
2. Fill in secrets (DB passwords, OAuth keys).
   *Never commit real secrets.*
3. Docker Compose automatically loads `.env`.

**Required Auth0 Variables:**
```bash
AUTH0_DOMAIN=your-tenant.us.auth0.com
AUTH0_CLIENT_ID=your_client_id_here
AUTH0_ALGORITHMS=["RS256"]
```

## 10. Useful Make Targets (coming soon)

```make
make dev     # build & start compose stack
make fmt     # black + isort
make lint    # static checks
make clean   # remove __pycache__, build artifacts
```

## 11. Testing the Auth System

### Quick Verification:
1. Start server: `uvicorn src.eduhub.main:app --reload --host 127.0.0.1 --port 8000`
2. Visit test console: `http://localhost:8000/test/auth-console`
3. Click "üöÄ Start Login Flow" and use test credentials
4. Verify user info displays after login

### API Testing:
1. Visit Swagger UI: `http://localhost:8000/docs`
2. Test protected endpoints with valid JWT tokens
3. Verify rate limiting and error handling

---

Happy hacking!
Questions? Open an issue or check the authentication setup guide for Auth0 troubleshooting.
